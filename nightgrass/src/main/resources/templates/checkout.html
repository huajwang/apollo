<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Checkout</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
<h2>Checkout</h2>
<button id="checkout-button">Pay Now</button>

<script th:inline="javascript">
    const stripe = Stripe([[${STRIPE_PUBLIC_KEY}]]);
    document.getElementById("checkout-button").addEventListener("click", function () {
        fetch("/create-checkout-session", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ amount: "1.00" })
        })
        .then(response => {
            if (!response.ok) {
                return response.text().then(errorText => {
                    throw new Error('Network response was not ok: ' + errorText);
                });
            }
            return response.text();
        })
        .then(sessionUrl => {
            window.location = sessionUrl;
        })
        .catch(error => console.error('Error: ', error));
    });
</script>
</body>
</html>
