<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail</title>
  <link rel="stylesheet" href="/css/product-detail.css" th:href="@{/css/product-detail.css}">
  <link rel="stylesheet" th:href="@{/css/bottom_nav.css}">
  <link rel="stylesheet" th:href="@{/css/cart.css}">
</head>
<body>
<div class="product-detail-container">
  <!-- Carousel Section -->
  <div class="carousel">
    <div class="carousel-track">
      <div th:each="productPhoto : ${productPhotos}" class="carousel-slide">
        <img th:src="${productPhoto.photoUrl}" alt="Product Photo">
      </div>
    </div>
    <!-- Navigation buttons -->
    <button class="carousel-button prev" id="prevBtn">❮</button>
    <button class="carousel-button next" id="nextBtn">❯</button>
  </div>




  <!-- Video Icons Section -->
  <div class="video-icons">
    <div th:each="video : ${productVideos}" class="video-icon">
      <a th:href="@{/videos/{filename}(filename=${video.fileName})}" target="_blank">
        <img src="/icons/video-icon.png" alt="Play Video" class="video-icon-image">
      </a>
    </div>
  </div>

  <!-- Optional Video Modal -->
  <div id="videoModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <video id="videoPlayer" controls>
        <source id="videoSource" src="" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>

  <!-- Product Options Section -->
  <div class="product-options">
    <div th:each="property : ${productProperties}">
      <div class="option-group">
        <h3 th:text="'Select ' + ${property.propertyName} + ':'"></h3>
        <div class="option-buttons">
          <button type="button"
                  class="option-button"
                  th:data-property="${property.propertyName}"
                  th:data-value="${value}"
                  th:each="value, iterStat : ${property.propertyValue.split(',')}"
                  th:text="${value}"
                  th:classappend="${iterStat.index == 0 ? 'selected' : ''}">
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Comments Section -->
  <div class="user-comments">
    <h3>Customer Reviews</h3>
    <div class="comment">
      <p><strong>Jane Doe:</strong> Love the product! Great quality and perfect fit.</p>
    </div>
    <div class="comment">
      <p><strong>John Smith:</strong> The color options are amazing! Highly recommend.</p>
    </div>
  </div>

  <!-- Action Buttons Section -->
  <div class="action-buttons">
    <form th:action="@{/cart/add}" method="post" id="add-to-cart-form">
      <input type="hidden" name="productId" th:value="${product.productId}">
      <!-- Dynamic properties -->
      <input type="hidden"
             th:each="property : ${productProperties}"
             th:id="'selected-' + ${property.propertyName}"
             th:name="'properties[' + ${property.propertyName} + ']'"
             th:value="${property.propertyValue.split(',')[0]}">

      <button type="submit" class="add-to-cart">Add to Cart</button>
    </form>
    <button class="buy-now">Buy Now</button>
  </div>

</div>

<!-- Include the bottom navigation bar -->
<div th:replace="nav :: bottom-nav"></div>

<script>
  // console.log("Script loaded");

  // Forces a reload when navigating back to the cart page
  window.addEventListener("pageshow", function (event) {
      // console.log("pageshow event triggered");
      if (event.persisted) {
          //console.log("Page loaded from cache, reloading...");
          window.location.reload();
      }
  });


  document.addEventListener("DOMContentLoaded", function () {
    const videoLinks = document.querySelectorAll(".video-icon a");
    const modal = document.getElementById("videoModal");
    const closeModal = document.getElementById("closeModal");
    const videoPlayer = document.getElementById("videoPlayer");
    const videoSource = document.getElementById("videoSource");

    videoLinks.forEach(link => {
      link.addEventListener("click", function (event) {
        event.preventDefault();
        const videoUrl = link.getAttribute("href");
        videoSource.src = videoUrl;
        videoPlayer.load();
        modal.style.display = "block";
      });
    });

    closeModal.addEventListener("click", function () {
      modal.style.display = "none";
      videoPlayer.pause();
    });

    window.addEventListener("click", function (event) {
      if (event.target === modal) {
        modal.style.display = "none";
        videoPlayer.pause();
      }
    });
  });



  document.addEventListener("DOMContentLoaded", function () {
    const track = document.querySelector(".carousel-track");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const slides = Array.from(track.children); // Carousel slides
    const slideWidth = slides[0].getBoundingClientRect().width; // Width of one slide
    let currentSlide = 0;

    // Position slides side by side
    slides.forEach((slide, index) => {
      slide.style.left = `${slideWidth * index}px`;
    });

    // Function to move the carousel track
    const moveToSlide = (currentSlideIndex) => {
      track.style.transform = `translateX(-${currentSlideIndex * slideWidth}px)`;
    };

    // Click event for next button
    nextBtn.addEventListener("click", () => {
      if (currentSlide < slides.length - 1) {
        currentSlide++;
        moveToSlide(currentSlide);
      }
    });

    // Click event for previous button
    prevBtn.addEventListener("click", () => {
      if (currentSlide > 0) {
        currentSlide--;
        moveToSlide(currentSlide);
      }
    });
  });

document.addEventListener("DOMContentLoaded", function () {
  // Add click event listeners to all option buttons
  document.querySelectorAll(".option-button").forEach(button => {
    button.addEventListener("click", function () {
      const property = button.dataset.property;
      const value = button.dataset.value;

      // Remove 'selected' class from all buttons in the same group
      document.querySelectorAll(`.option-button[data-property="${property}"]`).forEach(btn => {
        btn.classList.remove("selected");
      });

      // Add 'selected' class to the clicked button
      button.classList.add("selected");

      // Update the hidden input for the selected property
      const hiddenInput = document.getElementById(`selected-${property}`);
      if (hiddenInput) {
        hiddenInput.value = value;
      }
    });
  });
});




</script>
</body>
</html>
